# config 版本，请勿修改
config-version: 18

# 语言标签，对应 lang/ 下的文件名
locale: zh_CN

debug:
  # 是否启用插件调试日志
  enabled: false

# 健康检查与自动修复
health:
  # 是否启用健康监控
  enabled: true
  # 检查间隔（秒）
  check-interval-seconds: 5
  # 是否启用自动修复（false 则只告警不修复）
  auto-fix-enabled: true
  # 列车静止告警阈值（秒）：有 PROCEED 信号但静止超过此时间
  stall-threshold-seconds: 30
  # 进度停滞告警阈值（秒）：进度索引长时间不变
  progress-stuck-threshold-seconds: 60
  # STOP 信号下 progress stuck 的宽限阈值（秒）：用于区分“正常排队”等待与真实异常
  progress-stop-grace-seconds: 180
  # 自动修复动作冷却（秒）：避免每轮健康检查都重复触发恢复动作
  recovery-cooldown-seconds: 10
  # 占用超时清理阈值（分钟）
  occupancy-timeout-minutes: 5
  # 是否启用孤儿占用清理（列车已消失但占用未释放）
  orphan-cleanup-enabled: true
  # 是否启用超时占用清理
  timeout-cleanup-enabled: true

graph:
  # 图查询/ETA 默认速度（blocks per second），用于 /fta graph query/path 等诊断命令的估算
  default-speed-blocks-per-second: 8.0
  # 牌子节点寻找轨道锚点的半径（blocks）
  sign-anchor-search-radius: 6
  # switcher 节点寻找轨道锚点的半径（blocks）
  switcher-anchor-search-radius: 2

autostation:
  # 关门提示音（Bukkit Sound enum 或自定义 sound key）
  door-close-sound: "BLOCK_NOTE_BLOCK_BELL"
  # 关门提示音音量
  door-close-sound-volume: 1.0
  # 关门提示音音高
  door-close-sound-pitch: 1.2

runtime:
  # 运行时信号/闭塞监测 tick 间隔
  dispatch-tick-interval-ticks: 50
  # 发车/加速动作节流（ticks），0 表示不节流
  launch-cooldown-ticks: 10

  hud:
    bossbar:
      # 是否启用“车上 BossBar HUD”
      enabled: true
      # BossBar 刷新间隔（ticks）
      tick-interval-ticks: 10
      # BossBar 标题模板（MiniMessage），留空则使用 default_hud_template.yml
      # 占位符: {label_line} {line} {line_code} {line_name} {line_color} {line_color_tag} {operator}
      #        {company} {company_code} {company_name}
      #        {route_code} {route_id} {route_name} {dest_eor} {dest_eor_code} {dest_eor_lang2}
      #        {dest_eop} {dest_eop_code} {dest_eop_lang2} {current_station} {current_station_code} {current_station_lang2}
      #        {label_next} {next_station} {next_station_code} {next_station_lang2}
      #        {eta_status} {eta_minutes} {speed} {speed_kmh} {speed_bps} {speed_unit}
      #        {signal_status} {signal_aspect} {service_status} {progress} {progress_percent}
      #        {train_name} {layover_wait} {player_carriage_no} {player_carriage_total}
      template: ""
    actionbar:
      # 是否启用“车上 ActionBar HUD”
      enabled: true
      # ActionBar 刷新间隔（ticks）
      tick-interval-ticks: 10
      # ActionBar 模板（MiniMessage），留空则使用 default_hud_template.yml
      # 占位符同 BossBar（见上方），支持 HUD State 分支（如 ARRIVING/TERM_ARRIVING）
      template: ""
    player_display:
      # 是否启用“车上 Scoreboard LCD（player_display）”
      enabled: true
      # Scoreboard 刷新间隔（ticks）
      tick-interval-ticks: 10
      # Scoreboard 模板（YAML + MiniMessage），留空则使用 default_hud_template.yml
      template: ""
  # 占用请求 lookahead 边数
  lookahead-edges: 3
  # 同向跟驰最小空闲边数
  min-clear-edges: 2
  # 尾部保护占用边数（当前节点向后 N 段边）
  rear-guard-edges: 1
  # 道岔区联合锁闭范围（向前 N 段边）
  switcher-zone-edges: 3
  # 进站/STOP waypoint approaching 限速（blocks per second）
  approach-speed-bps: 10.0
  # 进库前的限速（blocks per second）
  approach-depot-speed-bps: 5.0
  # CAUTION 信号速度上限（blocks per second），可被连通分量覆盖
  caution-speed-bps: 10.0
  # 是否启用“提前减速”速度曲线（根据剩余距离与制动能力动态限速）
  speed-curve-enabled: true
  # 速度曲线类型：physics/linear/quadratic/cubic
  speed-curve-type: "physics"
  # 速度曲线放大系数（>1 更激进，<1 更保守）
  speed-curve-factor: 1.0
  # 提前减速缓冲距离（blocks），用于更早开始降速
  speed-curve-early-brake-blocks: 0.0
  # 是否启用移动授权（Movement Authority）：授权距离不足时主动降级信号并压速
  movement-authority-enabled: true
  # STOP 授权安全余量（blocks）：制动距离 + 此余量不足时将强制 STOP
  movement-authority-stop-margin-blocks: 2.0
  # CAUTION 授权安全余量（blocks）：制动距离 + 此余量不足时会降级到更保守信号
  movement-authority-caution-margin-blocks: 8.0
  # 速度命令迟滞（blocks/s）：目标速度变化小于该值时不更新，抑制抖动
  speed-command-hysteresis-bps: 0.15
  # 速度命令增速限幅系数：基于列车 accel（1.0 表示与列车加速度一致）
  speed-command-accel-factor: 1.0
  # 速度命令降速限幅系数：基于列车 decel（1.0 表示与列车减速度一致）
  speed-command-decel-factor: 1.0
  # 最短路距离缓存异步刷新周期（秒）
  distance-cache-refresh-seconds: 3
  # failover：低速判定阈值（blocks per second）
  failover-stall-speed-bps: 0.2
  # failover：低速连续 tick 触发阈值（以 dispatch-tick 为单位）
  failover-stall-ticks: 60
  # failover：目标不可达时强制停车
  failover-unreachable-stop: true

spawn:
  # 是否启用“基于线路 baseFrequency 的自动发车”
  # - enabled=false 时仅提供命令手动 /fta depot spawn
  # - enabled=true 时将周期性生成 SpawnTicket，并在闭塞门控允许时从 CRET 指定的 depot 自动 spawn 列车
  enabled: false
  # 自动发车 tick 间隔（ticks）
  tick-interval-ticks: 100
  # 刷新发车计划的间隔（ticks）：会从数据库重新读取 Company/Operator/Line/Route/RouteStop
  plan-refresh-ticks: 200
  # 每次 tick 最多尝试 spawn 的数量（避免卡主线程/刷车）
  max-spawn-per-tick: 1
  # 每次 tick 最多生成的票据数量（用于追赶 dueTime；建议与 max-backlog-per-service 配合）
  max-generate-per-tick: 5
  # 每条服务（route）最多积压的票据数量（防止长时间堵塞后爆发性补发）
  max-backlog-per-service: 5
  # spawn 失败/门控阻塞后的重试延迟（ticks）
  retry-delay-ticks: 40
  # spawn 最大重试次数（attempts >= max 时放弃该票据）
  max-attempts: 10
  # Layover 复用降级发车：当 RETURN 票据等待超过 (baselineFreq × layover-fallback-multiplier) 秒后，
  # 从 Depot 直接补发而非继续等待 Layover 列车。设为 0 禁用降级（永远等待 Layover）。
  layover-fallback-multiplier: 2.0

train:
  # 默认车种（emu/dmu/diesel_push_pull/electric_loco）
  default-type: emu
  types:
    emu:
      accel-bps2: 0.8
      decel-bps2: 1.0
    dmu:
      accel-bps2: 0.7
      decel-bps2: 0.9
    diesel_push_pull:
      accel-bps2: 0.6
      decel-bps2: 0.8
    electric_loco:
      accel-bps2: 0.9
      decel-bps2: 1.1

storage:
  # 可选值：sqlite / mysql
  backend: sqlite

  sqlite:
    # 插件数据目录下的 SQLite 文件名
    file: "data/fetarute.sqlite"

  mysql:
    # 数据库地址，含主机/IP
    db_address: "127.0.0.1"
    # 数据库端口
    db_port: 3306
    # 数据库名/Schema
    db_table: "fetarute_tc"
    # 数据库用户名
    db_username: "fta"
    # 数据库密码
    db_password: "change-me"
    # 可选：表前缀，避免与其他插件冲突
    table_prefix: "fta_"

  # 连接池设置（HikariCP）
  pool:
    # 最大连接数（SQLite 会自动收敛为 1）
    maximum-pool-size: 5
    # 连接获取超时（毫秒）
    connection-timeout-ms: 30000
    # 空闲连接存活时间（毫秒）
    idle-timeout-ms: 600000
    # 连接最大生命周期（毫秒）
    max-lifetime-ms: 1800000
